<html>
  <head>
    <style>
      table, td, th {
        xpad: 20px;
	  margin: 20px;
	  text-align: center;
      }

.centered {
display: flex;
justify-content: center;

}

p {
	border: 1px solid black;
}

    </style>
  </head>
  <body>
<div class="centered">
    <textarea id = "text" onchange="sortPt(this.value)" onfocusin="this.value=''" rows="10" cols="80"></textarea>
</div>
<div class="centered">
    <h4>Unassigned</h4>
</div>
    <p id = "unassigned"></p>
<br><br>
<div class="centered">
    <h4>Mine</h4>
</div>
    <p id = "mine"></p>

    
    
    <script>
      class Pt {
        constructor (c) {
          this.name = c[0];
          console.log(c[0]);
          this.age = c[1];
	    if (c[3].length == "") {
		this.room = "Waiting Room"
	    }
	    else {
          	this.room = c[3].substr(2,3);
          }
          this.complaint = c[4];
          this.rating = c[5];
	    this.time = c[6];
	    let tmp = "0h "+c[6];
	    tmp = tmp.split(' ');
          tmp = tmp.splice(tmp.length-3,2);
          this.sortableTime = '';
	    for (let i = 0; i<tmp.length;i++) {
		if (tmp[i].length==2) {
		  this.sortableTime = this.sortableTime + " 0";
		}
		else {
		  this.sortableTime = this.sortableTime + " ";
		}
		this.sortableTime = this.sortableTime + tmp[i];
	    }
          this.status = c[7];
          this.provider = c[8].toUpperCase();
        }
      }
      
      function sortPt(t) {
	  t = t.replace('\nCCD (Ack)','');
        a = t.split('\n')
        
/*        example = "
        550
 
Sam G Washington, MD
Wilson Hospital Center
Find Patient
My List
ED Main
Global ED
Waiting Room
More Lists
WHITE,BILL 
25 M 
ED Main 
ED02 
Motor Vehicle Crash 
(4) Less Urgent 
1h 57m 
Ready for Discharge 
Unassigned
 
Jen H
PINK,MARK 
300 F 
ED Main 
ED03 
Abdominal Pain 
(3) Urgent 
1h 53m 
With Doctor 
Sign Up
 
Jen H
BLANK,YUKI 
750 M 
ED Main 
ED05 
Hypotension 
(1) Resuscitation 
1h 49m 
In Room 
Washington,K
        
Jen H        " 
RED,BILL 
25 M 
ED Main 
ED02 
Motor Vehicle Crash 
(4) Less Urgent 
1h 7m 
Ready for Discharge 
SIGN_UP,E
 
Jen H
PINK,MARK 
300 F 
ED Main 
ED03 
Abdominal Pain 
(3) Urgent 
2h 53m 
With Doctor 
SIGN_UP,E
 
Jen H
BLANK,YUKI 
750 M 
ED Main 
ED05 
Hypotension 
(1) Resuscitation 
1h 49m 
In Room 
Washington,K
        
Jen H        " 
*/

/* Get Provider's Name */
		temp = a[2].split(',');
console.log(temp);
		temp2 = temp[0].split(' ');
console.log(temp2);
		lastName = temp2[temp2.length-1].toUpperCase();

/*Get patients */
        count = a.length/11-1;
        pts = [];
        b = [];
  for (let i =0; i < count; i++) {
    b[i] = a.slice((i+1)*11-1,10+(i+2)*11-1);
    pts.push(new Pt(b[i]));
  }

        document.getElementById("unassigned").innerHTML = sorttable(pts,"SIGN");
        document.getElementById("mine").innerHTML = sortMine(pts,lastName.substr(0,3));
      }
      
      function sorttable(p,provider) {
        p.sort(function(a,b) {return (b.sortableTime < a.sortableTime?-1:1)});
        t = "<table>";
        t = t + '<tr><th style="width: 80px">Time</th><th style="width: 200px">ESI</th><th style="width: 200px">Complaint</th><th style="width: 200px">Name</th><th style="width: 80px">Room</th><th style="width: 200px">Status</th></tr>'
        for (i = 0; i<pts.length;i++) {
          if (((p[i].provider.startsWith(provider)) || (provider == "All")) && (p[i].provider.location != "Waiting Room")) {
            t = t + "<tr><td>"+p[i].time +"</td><td>"+ p[i].rating + "</td><td>"+ p[i].complaint + "</td><td>"+ p[i].name + "</td><td>"+ p[i].room + "</td><td>"+ p[i].status + "</td></tr>";
          }
        }
        t=t+"</table>";
        return(t);
      }

      function sortMine(p,provider) {
        p.sort(function(a,b) {return (a.room < b.room?-1:1)});
        t = "<table>";
        t = t + '<tr><th style="width: 80px">Room</th><th style="width: 80px">Time</th><th style="width: 200px">ESI</th><th style="width: 200px">Complaint</th><th style="width: 200px">Name</th><th style="width: 200px">Status</th></tr>'
        for (i = 0; i<pts.length;i++) {
          if ((p[i].provider.startsWith(provider)) || (provider == "All")) {
            t = t + "<tr><td>"+ p[i].room + "</td><td>"+p[i].time +"</td><td>"+ p[i].rating + "</td><td>"+ p[i].complaint + "</td><td>"+ p[i].name + "</td><td>"+ p[i].status + "</td></tr>";
          }
        }
        t=t+"</table>";
        return(t);
      }
    </script>
  </body>
</html>
